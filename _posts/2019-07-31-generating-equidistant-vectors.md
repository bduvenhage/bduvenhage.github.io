---
layout: post
title:  "Generating Equidistant Vectors"
date: 2019-07-31
published: false
comments: true
categories: [geometry]
tags: [geometry, computer graphics]
---

In this post I'll revive work I did during my PhD to generate 3D vectors that are equally spaced on the unit sphere. Such equidistant vectors are useful for many operations over the sphere, to precalculate random unit vectors and to tesselate a sphere. The method is based on a spiral walk of the spherical surface in angular increments of size equal to the golden angle related to the golden ratio.

<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>

The golden ratio is related to the Fibonacci sequence ...
For this reason the spiral is often referred to as the Fibonacci spiral sphere ...

The work was originally implemented for a paper on [Numerical Verification of Bidirectional Reflectance Distribution Functions for Physical Plausibility](https://dl.acm.org/citation.cfm?id=2513499). The PDF of a pre-print of the paper is also available from [ResearchGate](https://www.researchgate.net/publication/259885429_Numerical_Verification_of_Bidirectional_Reflectance_Distribution_Functions_for_Physical_Plausibility) and via my [Google Scholar page](https://scholar.google.com/citations?user=jqhH0o4AAAAJ). In this post I'll describe the method using a Fibonacci spiral, but the paper also discussed an alternative based on subdivision of a 20-sided regular icosahedron.

## The Fibonacci Spiral Disc
The Fibonacci spiral is a way stepping around a circle to generate angular positions with limited repeating structure. One of the best step sizes to use is the golden angle. The golden angle $$\theta$$ is the angle of the small arc $$b$$ at which the ratio of the big arc on a circle to the small arc is the same as the ratio of the full revolution to the big arc i.e. $$ \frac{a}{b} = \frac{a+b}{a}$$. This ratio is the golden ratio of around 1.618. The golden angle $$\theta$$ subtended by $$b$$ is approximately 2.400 radians or 137.5 degress.

<img src="/assets/images/golden_angle.jpg" width="640" />

`Limited repeating structure` implies that if one were to create a histogram of angles generated by this methods then the angle bins will always be approximately equally filled. Using [Vogal's method](https://www.sciencedirect.com/science/article/abs/pii/0025556479900804?via%3Dihub), one can combine this property with an increasing radius $$r$$ to evenly distribute sample points on a 2D disc. Even distribution of points over larger radii of the disc is ensured by having $$r = k\sqrt{i}$$ for $$i$$ the index of the point being generated and $$k$$ inversely proportional to the overall density of the points. 

Therefore, point $$ P_i = (i\theta, k\sqrt{i})$$ in polar coordiates for point index $$i$$. The images below show what 500 points on the disc looks like for $$k = 10.0$$ and $$k = 5.0$$.

<img src="/assets/images/fibonacci_spiral_disc_10.jpg" width="320" />
<img src="/assets/images/fibonacci_spiral_disc_5.jpg" width="320" />

## The Fibonacci Spiral Sphere
One can use a similar spiral method to also distribute points on a sphere. To evenly distribute the points, more points are allocated to larger circles on the sphere. If the spiral starts at a sphere's pole then the radius and circumferance of the spiral at any point is proportional to $$ \cos{lat} $$ for $$ lat = [-\frac{\pi}{2}, \frac{\pi}{2}]. The density of the points allocated to the spiral is therefore also proportional to $$\cos{lat}$$ and the continuous distribution function (CDF) of the points is proportional to $$\sin(lat)+1$$. 

Therefore, the point index $$i$$ can be calculated with $$ i = h (\sin(lat)+1) $$  for $$h = num_points * 0.5$$.
Then taking the inverse, $$ lat = \arcsin (point_index/h-1)$$.

Wrapping this up, $$P_i = (i\theta, \arcsin (i/h-1))$$, may be used to calculate the polar coordinates of any of the equidistant vectors.

<img src="/assets/images/fibomesh.jpg" width="320" />
<img src="/assets/images/fibogeodual.jpg" width="320" />

Above is shown a Fibonacci spiral sphere with 162 vectors (on the left) and its geometric dual on the right. The mesh on the right shows the shape of the voronoi bin around each vector.

## Symmary
The full [source](https://github.com/bduvenhage/Bits-O-Cpp/tree/master/random) with execution timing
is available in my [Bits-O-Cpp](https://github.com/bduvenhage/Bits-O-Cpp) GitHub repo.
